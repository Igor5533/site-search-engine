# Site Search Engine

**Site Search Engine** — учебный проект на Java/Spring Boot для многопоточной индексации сайтов и поиска по ним с учётом лемматизации (Lucene Morphology).

## Оглавление
1. [Описание](#описание)
2. [Технологии](#технологии)
3. [Структура проекта](#структура-проекта)
4. [Подготовка к запуску](#подготовка-к-запуску)
5. [Запуск проекта](#запуск-проекта)
6. [Использование](#использование)
7. [Лицензия](#лицензия)

---

## Описание

Приложение позволяет:
- **Индексировать** указанные в конфигурации сайты (рекурсивный обход ссылок).
- **Хранить** данные о сайтах, страницах и леммах в базе данных (MySQL).
- **Выполнять поиск** по леммам с учётом морфологии русского языка (библиотека Apache Lucene Morphology).
- **Рассчитывать релевантность** найденных страниц и формировать «сниппеты» с подсветкой ключевых слов.

Благодаря многопоточности (Fork–Join) индексация выполняется параллельно и быстро обрабатывает большое количество страниц.

---

## Технологии

Основной стек:
- **Java 17+**
- **Spring Boot** (Web, Data JPA, etc.)
- **Hibernate / JPA**
- **MySQL**
- **JSoup** (парсинг HTML и извлечение ссылок)
- **Apache Lucene Morphology** (лемматизация)
- **Maven** (сборка проекта)
- **Lombok** (генерация геттеров/сеттеров и т. п.)

---

## Структура проекта

 ```bash
.
├── src
│   ├── main
│   │   ├── java
│   │   │   ├── searchengine
│   │   │   │   ├── config          # Классы для чтения конфигурации (SitesList, Site)
│   │   │   │   ├── controllers     # REST-контроллеры (ApiController, DefaultController)
│   │   │   │   ├── dao             # Репозитории (PageRepository, SiteRepository, и т.д.)
│   │   │   │   ├── dto             # Data Transfer Objects (DTO)
│   │   │   │   ├── model           # JPA-сущности (Site, Page, Lemma, IndexEntity)
│   │   │   │   ├── services        # Сервисы (IndexingService, SearchService, StatisticsService)
│   │   │   │   └── util            # Вспомогательные классы (LemmaFinder, и т.д.)
│   │   │   └── ...
│   │   ├── resources
│   │   │   ├── application.yaml    # Настройки приложения (URL БД, список сайтов, и т.д.)
│   │   │   └── templates           # Шаблоны (index.html) — если используется Thymeleaf
│   └── test                        # Тесты (при необходимости)
├── pom.xml                         # Файл проекта Maven
└── README.md                       # Текущее описание проекта
 ```

Основные пакеты:

 - config — классы для загрузки списка сайтов из application.yaml.
 - controllers — REST-контроллеры (например, ApiController) и контроллер для главной страницы.
 - dao — Spring Data JPA репозитории.
 - dto — объекты для передачи данных (статистика, результаты поиска, и т. д.).
 - model — сущности JPA (Site, Page, Lemma, IndexEntity) и enum SiteStatus.
 - services — бизнес-логика (индексация, поиск, статистика).
 - util — вспомогательные классы (например, LemmaFinder для лемматизации).

## Подготовка к запуску
1.Установите необходимое ПО:
 - Java 17+
 - Maven 3.6+
 - MySQL (или аналогичную СУБД)
2.Склонируйте репозиторий:
    ```bash
    git clone https://github.com/site-search-engine.git
    cd site-search-engine
    ```
3.Настройте базу данных:
 - Создайте базу данных (например, search_engine_db).
 - Убедитесь, что у вас есть пользователь с правами на чтение/запись для этой базы.
4.Настройте конфигурационный файл: В файле src/main/resources/application.yaml укажите параметры подключения к базе данных и список сайтов:
```yaml
    spring:
    datasource:
      url: jdbc:mysql://localhost:3306/search_engine_db?useSSL=false&characterEncoding=UTF-8
      username: your_db_username
      password: your_db_password
    jpa:
      hibernate:
        ddl-auto: update
      show-sql: false

    indexing-settings:
      user-agent: "HeliontSearchBot"
      referrer: "http://www.google.com"
      sites:
        - url: "http://example.com"
          name: "Example Site"
        - url: "http://playback.ru"
          name: "Playback"
```
## Запуск проекта
1. Соберите проект:
```bash
    mvn clean install
```
2. Запустите приложение:
```bash
    mvn spring-boot:run
```
Приложение будет запущено на порту 8080.
3. Откройте веб-интерфейс: Перейдите в браузере по адресу http://localhost:8080.

## Использование API
Приложение предоставляет набор REST API для управления индексацией и поиска.
# Запуск и остановка индексации
 - Запуск индексации
GET http://localhost:8080/api/startIndexing
Запускает многопоточную индексацию всех сайтов, указанных в конфигурации.

 - Остановка индексации
GET http://localhost:8080/api/stopIndexing
Останавливает текущую индексацию и устанавливает статус сайтов в FAILED (если индексация не завершена).

# Индексация отдельной страницы
 - Индексация страницы
POST http://localhost:8080/api/indexPage?url={URL}
Добавляет или обновляет индекс указанной страницы. Если страница уже была проиндексирована, старая информация удаляется и заменяется новой.
 - Поиск
   - Поиск по запросу
     GET http://localhost:8080/api/search?query={запрос}&site={siteUrl}&offset={смещение}&limit={лимит}
   Параметры запроса:
     - query (обязательный) — поисковый запрос.
     - site (необязательный) — адрес сайта, по которому выполнять поиск (если не указан, поиск ведётся по всем проиндексированным сайтам).
     - offset (по умолчанию 0) — смещение для постраничного вывода.
     - limit (по умолчанию 20) — количество результатов на странице.

```json
{
    "result": true,
    "count": 574,
    "data": [
        {
            "site": "http://example.com",
            "siteName": "Example Site",
            "uri": "/path/to/page/6784",
            "title": "Заголовок страницы",
            "snippet": "Фрагмент текста, где <b>выделены</b> совпадения...",
            "relevance": 0.93362
        }
    ]
}
```
Пример ответа при ошибке:
```json
{
    "result": false,
    "error": "Задан пустой поисковый запрос"
}
```
## Статистика
 - Получение статистики
   GET http://localhost:8080/api/statistics
   Возвращает общую статистику по индексированным сайтам, количеству страниц, лемм и статусу индексации.

## Лицензия
Этот проект создан в учебных целях. Вы можете свободно использовать, изменять и распространять данный код.
Автор: Игорь Медведев, 2025.